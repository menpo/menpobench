#!/usr/bin/env python
# encoding: utf-8
"""The Menpo Deformable Model benchmarking suite


<experiment_config> can be either the name of a predefined experiment, or the
path to a .yaml experiment configuration file.

Usage:
  menpobench <experiment_config>
  menpobench --list
  menpobench (-h | --help)
  menpobench --version

Options:
  --list     List all available predefined datasets, methods, and experiments.
  -h --help  Show this screen.
  --version  Show version.
"""
import menpobench
from menpobench import invoke_benchmark, configure_cache_dir
from menpobench.config import NoMenpoBenchCacheConfigError
from docopt import docopt


def invoke_benchmark_with_cache_config_prompt(experiment_name):
    try:
        invoke_benchmark(experiment_name)
    except NoMenpoBenchCacheConfigError:
        print('Welcome to menpobench. To start, you will need to choose a directory')
        print('that menpobench can use as a cache.')
        print('This directory will be managed by menpobench to store datasets and')
        print('temporary results. Anticipate it to get quite large (~20GB).')
        cache_dir = raw_input('Please enter cache directory: ')
        configure_cache_dir(cache_dir)
        # now we have a cache dir, re-run
        invoke_benchmark_with_cache_config_prompt(experiment_name)
    except ValueError as e:
        print('ERROR: {}'.format(e.message))
        exit(1)


def list_all_predefined():
    from menpobench.experiment import list_predefined_experiments
    from menpobench.dataset import list_predefined_datasets
    from menpobench.method import (list_predefined_methods,
                                   list_predefined_untrainable_methods)
    import yaml
    print(yaml.dump({'datasets': list_predefined_datasets(),
                     'methods': list_predefined_methods(),
                     'untrainable_methods': list_predefined_untrainable_methods(),
                     'experiments': list_predefined_experiments()
                     }, default_flow_style=False))


if __name__ == '__main__':
    args = docopt(__doc__,
                  version='menpobench v{}'.format(menpobench.__version__))
    if args['--list']:
        list_all_predefined()
    else:
        invoke_benchmark_with_cache_config_prompt(args['<experiment_config>'])
